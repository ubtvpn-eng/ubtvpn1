---
title: 'Личный VPN на WireGuard: Поднимаем сервер на Ubuntu 22.04'
description: 'Пошаговый гайд по развертыванию WireGuard VPN на VPS. Установка, генерация ключей, настройка конфигов и QR-кодов. Дешевле и быстрее платных аналогов.'
pubDate: 2026-01-08
author: 'NetFreedom Admin'
image: '/images/wireguard-guide.jpg'
tags: ['WireGuard', 'Ubuntu', 'VPN', 'Гайд']
---

Приветствую. Если вы читаете эту статью, значит, вы устали от медленных публичных VPN, постоянных разрывов соединения и риска, что ваши данные "утекут" к третьим лицам.

Сегодня мы решим эту проблему кардинально. Мы поднимем **свой собственный VPN-сервер** на базе протокола **WireGuard**.

> **Почему WireGuard?** Это современный протокол (в ядре Linux с версии 5.6), который быстрее, проще и безопаснее громоздкого OpenVPN. Он содержит всего около 4000 строк кода (против 100 000+ у OpenVPN), что минимизирует поверхность атаки.

## Предварительные требования

Перед началом убедитесь, что у вас есть:

1.  **VPS/VDS сервер**. Подойдет любой хостинг (Aeza, Timeweb, DigitalOcean, Hetzner) с локацией в Европе.
    *   *OS*: Ubuntu 20.04 или 22.04 LTS.
    *   *Характеристики*: 1 CPU, 512MB RAM достаточно (WireGuard очень легкий).
2.  **Терминал**. Если у вас macOS/Linux — штатный Terminal. Если Windows — PowerShell или PuTTY.
3.  **Root-права**. Вы должны иметь возможность выполнять команды от имени суперпользователя.

---

## Шаг 1: Подготовка сервера

Подключитесь к вашему серверу по SSH. Замените `ip-address` на IP вашего сервера.

```bash
ssh root@ip-address
```

Первым делом — правило хорошего тона. Обновим списки пакетов и систему, чтобы не наткнуться на старые баги.

```bash
apt update && apt upgrade -y
```

## Шаг 2: Установка WireGuard

В Ubuntu 22.04 WireGuard уже есть в репозиториях. Устанавливаем его одной командой:

```bash
apt install wireguard -y
```

После установки нам нужно сгенерировать ключи шифрования. WireGuard использует асимметричное шифрование:
*   **Private Key (Приватный ключ)**: Хранится секретно на устройстве.
*   **Public Key (Публичный ключ)**: Передается второй стороне (сервер знает публичный ключ клиента, и наоборот).

Создадим папку для ключей и сгенерируем их для **сервера**:

```bash
# Переходим в директорию WireGuard
cd /etc/wireguard/

# Генерируем ключи. umask 077 делает файлы доступными только владельцу (root)
umask 077
wg genkey | tee server_private.key | wg pubkey > server_public.key
```

Теперь у вас есть два файла: `server_private.key` и `server_public.key`. Посмотрим их содержимое (оно нам понадобится):

```bash
cat server_private.key
# Вывод: <ВАШ_ПРИВАТНЫЙ_КЛЮЧ>

cat server_public.key
# Вывод: <ВАШ_ПУБЛИЧНЫЙ_КЛЮЧ>
```

> ⚠️ **Важно:** Никогда не передавайте `server_private.key` третьим лицам!

## Шаг 3: Настройка конфигурации сервера

Создадим конфигурационный файл интерфейса `wg0`.

```bash
nano /etc/wireguard/wg0.conf
```

Вставьте в него следующий конфиг, заменив `<Server_Private_Key>` на то, что мы получили шагом ранее.

```ini
[Interface]
# Приватный IP адрес VPN-сервера внутри туннеля
Address = 10.0.0.1/24
# Порт, который будет слушать WireGuard (можно выбрать любой от 1024 до 65535)
ListenPort = 51820
# Приватный ключ сервера (вставьте содержимое server_private.key)
PrivateKey = <ВСТАВЬТЕ_ВАШ_SERVER_PRIVATE_KEY>
# Правила маршрутизации (NAT), чтобы у клиентов был интернет
# Замените eth0 на имя вашего интерфейса (проверьте командой ip a, часто это ens3)
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
SaveConfig = true
```

Сохраните файл (`Ctrl+O`, `Enter`) и выйдите (`Ctrl+X`).

## Шаг 4: Настройка сетевого экрана и форвардинга

Чтобы сервер мог пропускать трафик через себя, нужно включить IP Forwarding.

Откройте файл `sysctl.conf`:

```bash
nano /etc/sysctl.conf
```

Раскомментируйте (уберите `#`) строчку:

```conf
net.ipv4.ip_forward=1
```

Примените изменения:

```bash
sysctl -p
```

Если у вас включен фаервол (UFW), откройте порт 51820 UDP:

```bash
ufw allow 51820/udp
```

## Шаг 5: Запуск сервера

Активируем и запускаем службу WireGuard:

```bash
systemctl enable wg-quick@wg0
systemctl start wg-quick@wg0
```

Проверим статус:

```bash
systemctl status wg-quick@wg0
```

Если видите зеленый кружок (active) — поздравляю, половина пути пройдена. Сервер работает.

---

## Шаг 6: Настройка клиента (Ваш телефон/PC)

Теперь нам нужно создать "пользователя". Для WireGuard это просто еще одна пара ключей.

Сгенерируем ключи для клиента (на том же сервере):

```bash
cd /etc/wireguard/
wg genkey | tee client_private.key | wg pubkey > client_public.key
```

### 1. Добавляем пира (клиента) на сервер

Используем встроенную утилиту `wg`, чтобы добавить клиента "на лету", не перезагружая интерфейс:

```bash
# Синтаксис: wg set wg0 peer <Public_Key_Clienta> allowed-ips <IP_Клиента>
wg set wg0 peer $(cat client_public.key) allowed-ips 10.0.0.2/32
```

### 2. Создаем конфиг для клиента

Этот файл вы загрузите в приложение WireGuard на телефоне или компьютере. Создайте файл `client.conf` у себя на компьютере (в блокноте) или выведите текст в терминале и скопируйте.

Шаблон `client.conf`:

```ini
[Interface]
# Приватный ключ КЛИЕНТА (из файла client_private.key)
PrivateKey = <ВСТАВЬТЕ_CLIENT_PRIVATE_KEY>
# IP адрес клиента внутри сети VPN
Address = 10.0.0.2/32
# DNS сервера (Google или Cloudflare)
DNS = 8.8.8.8

[Peer]
# Публичный ключ СЕРВЕРА (из server_public.key)
PublicKey = <ВСТАВЬТЕ_SERVER_PUBLIC_KEY>
# IP адрес вашего VPS и порт
Endpoint = <IP_ВАШЕГО_VPS>:51820
# Какие IP пускать через туннель (0.0.0.0/0 = весь интернет)
AllowedIPs = 0.0.0.0/0
# Поддержка соединения (каждые 25 секунд)
PersistentKeepalive = 25
```

## Как удобно перенести конфиг на телефон?

Вводить ключи вручную на телефоне — мучение. Установим утилиту для генерации QR-кодов прямо в консоли:

```bash
apt install qrencode -y
```

Создайте файл `client.conf` на сервере с содержимым выше (подставив ключи) и выполните:

```bash
qrencode -t ansiutf8 < client.conf
```

В терминале появится QR-код. Просто отсканируйте его приложением WireGuard (iOS/Android), и все заработает мгновенно.

---

## Troubleshooting: Если что-то пошло не так

### 1. Соединение есть, но интернета нет
Скорее всего, проблема в Forwarding или имени интерфейса.
Проверьте имя основного интерфейса командой `ip a`. Если оно не `eth0` (например, `ens3`, `enp3s0`), поменяйте его в конфиге `/etc/wireguard/wg0.conf` в строках `PostUp` и `PostDown`.

### 2. Не подключается (Handshake не проходит)
Проверьте фаервол. Порт 51820 UDP должен быть открыт. В облачных хостингах (AWS, Oracle Cloud) порт нужно открывать еще и в панели управления хостингом (Security Lists).

---

## Заключение

Вы только что развернули свой личный, защищенный канал связи. Теперь вы не зависите от прихотей коммерческих VPN-провайдеров и имеете полный контроль над своим трафиком.

Это базовый сетап. В следующих статьях мы разберем, как маскировать WireGuard под обычный HTTPS трафик с помощью **AmneziaWG** или **Shadowsocks**, если ваш провайдер научился блокировать чистый протокол.
